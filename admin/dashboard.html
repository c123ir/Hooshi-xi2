<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل مدیریت چت</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="components/users-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap">
</head>
<body>
    <div id="admin-app">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-content">
                <h1><i class="fas fa-tachometer-alt"></i> پنل مدیریت</h1>
                <div class="header-actions">
                    <span class="admin-user">مدیر: <strong id="adminName">---</strong></span>
                    <button id="logoutBtn" class="btn btn-secondary">
                        <i class="fas fa-sign-out-alt"></i> خروج
                    </button>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-home"></i> داشبورد
                </a>
                <a href="#users" class="nav-item" data-section="users">
                    <i class="fas fa-users"></i> مدیریت کاربران
                </a>
                <a href="#stats" class="nav-item" data-section="stats">
                    <i class="fas fa-chart-bar"></i> آمار و گزارش
                </a>
                <a href="#system" class="nav-item" data-section="system">
                    <i class="fas fa-server"></i> وضعیت سیستم
                </a>
                <a href="#settings" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i> تنظیمات
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="admin-section active">
                <div class="section-header">
                    <h2>خلاصه عملکرد سیستم</h2>
                    <p>آخرین به‌روزرسانی: <span id="lastUpdate">---</span></p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalUsers">0</h3>
                            <p>کاربر فعال</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalChats">0</h3>
                            <p>چت ایجاد شده</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-message"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalMessages">0</h3>
                            <p>پیام ارسال شده</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="systemUptime">0</h3>
                            <p>ساعت فعالیت</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h3>فعالیت‌های اخیر</h3>
                    </div>
                    <div class="card-body">
                        <div id="recentActivity" class="activity-list">
                            <p class="loading">در حال بارگذاری...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Users Management Section Component -->
            <section id="users-section" class="admin-section">
                <div class="section-header">
                    <h2>مدیریت کاربران</h2>
                    <div class="header-actions">
                        <button id="addUserBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> افزودن کاربر
                        </button>
                        <button id="refreshUsersBtn" class="btn btn-secondary">
                            <i class="fas fa-sync-alt"></i> تازه‌سازی
                        </button>
                        <button id="exportUsersBtn" class="btn btn-success">
                            <i class="fas fa-download"></i> صادر کردن
                        </button>
                    </div>
                </div>

                <!-- Filters and Search -->
                <div class="users-filters">
                    <div class="filter-group">
                        <label for="userSearchInput">جستجو:</label>
                        <input type="text" id="userSearchInput" placeholder="نام کاربری، نام، ایمیل..." class="form-control">
                    </div>
                    <div class="filter-group">
                        <label for="statusFilter">وضعیت:</label>
                        <select id="statusFilter" class="form-control">
                            <option value="all">همه</option>
                            <option value="active">فعال</option>
                            <option value="inactive">غیرفعال</option>
                        </select>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-container">
                            <table id="usersTable" class="admin-table">
                                <thead>
                                    <tr>
                                        <th>کاربر</th>
                                        <th>ایمیل</th>
                                        <th>شماره همراه</th>
                                        <th>تاریخ عضویت</th>
                                        <th>آخرین فعالیت</th>
                                        <th>وضعیت</th>
                                        <th>نقش</th>
                                        <th>عملیات</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <tr>
                                        <td colspan="8" class="loading">در حال بارگذاری...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                <div id="usersPagination" class="pagination-container" style="display: none;">
                    <!-- Pagination buttons will be inserted here -->
                </div>
            </section>

            <!-- Stats Section -->
            <section id="stats-section" class="admin-section">
                <div class="section-header">
                    <h2>آمار و گزارش</h2>
                </div>

                <div class="charts-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>استفاده روزانه</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="dailyUsageChart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>مدل‌های محبوب</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="modelsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- System Section -->
            <section id="system-section" class="admin-section">
                <div class="section-header">
                    <h2>وضعیت سیستم</h2>
                </div>

                <div class="system-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>منابع سیستم</h3>
                        </div>
                        <div class="card-body">
                            <div class="resource-item">
                                <span>استفاده از حافظه:</span>
                                <div class="progress-bar">
                                    <div id="memoryUsage" class="progress-fill"></div>
                                </div>
                            </div>
                            <div class="resource-item">
                                <span>فضای دیسک:</span>
                                <div class="progress-bar">
                                    <div id="diskUsage" class="progress-fill"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>خطاهای اخیر</h3>
                        </div>
                        <div class="card-body">
                            <div id="recentErrors" class="error-list">
                                <p class="loading">در حال بارگذاری...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="admin-section">
                <div class="section-header">
                    <h2>تنظیمات سیستم</h2>
                </div>

                <div class="settings-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>تنظیمات عمومی</h3>
                        </div>
                        <div class="card-body">
                            <div class="setting-item">
                                <label for="siteName">نام سایت:</label>
                                <input type="text" id="siteName" value="پنل مدیریت چت" class="form-control">
                            </div>
                            <div class="setting-item">
                                <label for="maxUsers">حداکثر کاربران:</label>
                                <input type="number" id="maxUsers" value="1000" class="form-control">
                            </div>
                            <div class="setting-item">
                                <label for="maintenanceMode">
                                    <input type="checkbox" id="maintenanceMode"> حالت تعمیر و نگهداری
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>تنظیمات چت</h3>
                        </div>
                        <div class="card-body">
                            <div class="setting-item">
                                <label for="maxChatLength">حداکثر طول پیام:</label>
                                <input type="number" id="maxChatLength" value="4000" class="form-control">
                            </div>
                            <div class="setting-item">
                                <label for="allowFileUpload">
                                    <input type="checkbox" id="allowFileUpload" checked> اجازه آپلود فایل
                                </label>
                            </div>
                            <div class="setting-item">
                                <label for="autoSave">
                                    <input type="checkbox" id="autoSave" checked> ذخیره خودکار
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>تنظیمات امنیتی</h3>
                        </div>
                        <div class="card-body">
                            <div class="setting-item">
                                <label for="sessionTimeout">مهلت نشست (دقیقه):</label>
                                <input type="number" id="sessionTimeout" value="60" class="form-control">
                            </div>
                            <div class="setting-item">
                                <label for="requireAuth">
                                    <input type="checkbox" id="requireAuth" checked> احراز هویت اجباری
                                </label>
                            </div>
                            <div class="setting-item">
                                <label for="logUserActivity">
                                    <input type="checkbox" id="logUserActivity" checked> ثبت فعالیت کاربران
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>پشتیبان‌گیری و بازیابی</h3>
                    </div>
                    <div class="card-body">
                        <div class="backup-actions">
                            <button id="createBackup" class="btn btn-primary">
                                <i class="fas fa-download"></i> ایجاد پشتیبان
                            </button>
                            <button id="restoreBackup" class="btn btn-warning">
                                <i class="fas fa-upload"></i> بازیابی از پشتیبان
                            </button>
                            <button id="exportData" class="btn btn-secondary">
                                <i class="fas fa-file-export"></i> صادر کردن داده‌ها
                            </button>
                        </div>
                        <div class="backup-status">
                            <p>آخرین پشتیبان: <span id="lastBackup">هرگز</span></p>
                        </div>
                    </div>
                </div>

                <div class="settings-save">
                    <button id="saveSettings" class="btn btn-success">
                        <i class="fas fa-save"></i> ذخیره تنظیمات
                    </button>
                    <button id="resetSettings" class="btn btn-danger">
                        <i class="fas fa-undo"></i> بازگردانی پیش‌فرض
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">افزودن کاربر جدید</h3>
                <button class="modal-close" onclick="window.userManager.hideModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="userForm" class="modal-body">
                <input type="hidden" id="userId" name="userId">
                
                <div class="form-grid">
                    <!-- Personal Information -->
                    <div class="form-section">
                        <h4>اطلاعات شخصی</h4>
                        
                        <div class="form-group">
                            <label for="firstName">نام:</label>
                            <input type="text" id="firstName" name="firstName" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="lastName">نام خانوادگی:</label>
                            <input type="text" id="lastName" name="lastName" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="username">نام کاربری:</label>
                            <input type="text" id="username" name="username" class="form-control" required pattern="[a-zA-Z0-9_]+" title="فقط حروف انگلیسی، اعداد و _ مجاز است">
                        </div>
                        
                        <div class="form-group">
                            <label for="password">کلمه عبور:</label>
                            <input type="password" id="password" name="password" class="form-control" minlength="6">
                            <small class="form-text">حداقل 6 کاراکتر (در صورت ویرایش اختیاری)</small>
                        </div>
                    </div>
                    
                    <!-- Contact Information -->
                    <div class="form-section">
                        <h4>اطلاعات تماس</h4>
                        
                        <div class="form-group">
                            <label for="email">ایمیل:</label>
                            <input type="email" id="email" name="email" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">شماره همراه:</label>
                            <input type="tel" id="phone" name="phone" class="form-control" pattern="[0-9]+" title="فقط اعداد مجاز است">
                        </div>
                        
                        <div class="form-group">
                            <label for="profileImage">تصویر پروفایل (URL):</label>
                            <input type="url" id="profileImage" name="profileImage" class="form-control" placeholder="https://example.com/image.jpg">
                        </div>
                    </div>
                    
                    <!-- Account Settings -->
                    <div class="form-section">
                        <h4>تنظیمات حساب</h4>
                        
                        <div class="form-group">
                            <label for="role">نقش کاربری:</label>
                            <select id="role" name="role" class="form-control">
                                <option value="user">کاربر عادی</option>
                                <option value="admin">ادمین</option>
                            </select>
                        </div>
                        
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="isActive" name="isActive" checked>
                                حساب فعال
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label for="expiryDate">تاریخ انقضاء:</label>
                            <input type="date" id="expiryDate" name="expiryDate" class="form-control">
                            <small class="form-text">خالی = نامحدود</small>
                        </div>
                    </div>
                    
                    <!-- Usage Limits -->
                    <div class="form-section">
                        <h4>محدودیت‌های استفاده</h4>
                        
                        <div class="form-group">
                            <label for="maxChats">حداکثر تعداد چت:</label>
                            <input type="number" id="maxChats" name="maxChats" class="form-control" min="0" placeholder="نامحدود">
                            <small class="form-text">خالی = نامحدود</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="maxResponses">حداکثر پاسخ در هر چت:</label>
                            <input type="number" id="maxResponses" name="maxResponses" class="form-control" min="0" placeholder="نامحدود">
                            <small class="form-text">خالی = نامحدود</small>
                        </div>
                    </div>
                </div>
            </form>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="window.userManager.hideModal()">انصراف</button>
                <button type="submit" form="userForm" class="btn btn-primary">ذخیره</button>
            </div>
        </div>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <script src="../js/modules/ui.js"></script>
    <script src="modules/UserManager.js"></script>
    <script src="admin-simple.js"></script>
</body>
</html>
