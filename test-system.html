<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø³ÛŒØ³ØªÙ…</title>
    <style>
        body { font-family: Arial; padding: 20px; direction: rtl; }
        .test-item { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        button { margin: 5px; padding: 10px; }
        #logs { background: #f8f9fa; padding: 10px; margin-top: 20px; height: 300px; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª Ø³ÛŒØ³ØªÙ…</h1>
    
    <div id="moduleTests">
        <div class="test-item" id="authTest">ğŸ“¦ Auth Module: Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ...</div>
        <div class="test-item" id="chatTest">ğŸ“¦ Chat Module: Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ...</div>
        <div class="test-item" id="uiTest">ğŸ“¦ UI Module: Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ...</div>
        <div class="test-item" id="ttsTest">ğŸ“¦ TTS Module: Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ...</div>
    </div>
    
    <div>
        <button onclick="testAuth()">ØªØ³Øª Auth</button>
        <button onclick="testAPI()">ØªØ³Øª API</button>
        <button onclick="testUI()">ØªØ³Øª UI</button>
        <button onclick="testChats()">ØªØ³Øª Chats</button>
        <button onclick="clearLogs()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
    </div>
    
    <div id="logs"></div>
    
    <script>
        const logs = document.getElementById('logs');
        
        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString('fa-IR');
            const div = document.createElement('div');
            div.innerHTML = `[${time}] ${message}`;
            div.style.color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }
        
        function clearLogs() {
            logs.innerHTML = '';
        }
        
        function updateModuleStatus(module, status) {
            const element = document.getElementById(module + 'Test');
            if (element) {
                element.textContent = `ğŸ“¦ ${module.charAt(0).toUpperCase() + module.slice(1)} Module: ${status}`;
                element.className = `test-item ${status === 'Ø¢Ù…Ø§Ø¯Ù‡' ? 'success' : 'error'}`;
            }
        }
        
        // Ú†Ú© Ú©Ø±Ø¯Ù† modules
        function checkModules() {
            updateModuleStatus('auth', window.AuthModule ? 'Ø¢Ù…Ø§Ø¯Ù‡' : 'Ø®Ø·Ø§');
            updateModuleStatus('chat', window.ChatModule ? 'Ø¢Ù…Ø§Ø¯Ù‡' : 'Ø®Ø·Ø§');
            updateModuleStatus('ui', window.UIModule ? 'Ø¢Ù…Ø§Ø¯Ù‡' : 'Ø®Ø·Ø§');
            updateModuleStatus('tts', window.TTSModule ? 'Ø¢Ù…Ø§Ø¯Ù‡' : 'Ø®Ø·Ø§');
        }
        
        async function testAuth() {
            log('ğŸ”‘ ØªØ³Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª...');
            try {
                const response = await fetch('/api/auth/me');
                const data = await response.json();
                if (response.ok) {
                    log(`âœ… Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ø§Ø³Øª: ${data.username}`, 'info');
                } else {
                    log('â„¹ï¸ Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ù†ÛŒØ³Øª', 'warn');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± auth: ${error.message}`, 'error');
            }
        }
        
        async function testAPI() {
            log('ğŸ”— ØªØ³Øª API...');
            try {
                const response = await fetch('/api/chats');
                const data = await response.json();
                if (response.ok) {
                    log(`âœ… API Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ú†Øªâ€ŒÙ‡Ø§: ${data.length}`, 'info');
                } else {
                    log(`âŒ Ø®Ø·Ø§ Ø¯Ø± API: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± API: ${error.message}`, 'error');
            }
        }
        
        function testUI() {
            log('ğŸ¨ ØªØ³Øª UI...');
            const chatList = document.getElementById('chatList');
            log(`ChatList Ø¹Ù†ØµØ±: ${chatList ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª'}`);
            
            const userInput = document.getElementById('userInput');
            log(`UserInput Ø¹Ù†ØµØ±: ${userInput ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª'}`);
            
            const sendBtn = document.getElementById('sendBtn');
            log(`Send Button: ${sendBtn ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª'}`);
        }
        
        async function testChats() {
            log('ğŸ’¬ ØªØ³Øª Ú†Øªâ€ŒÙ‡Ø§...');
            if (window.ChatModule) {
                log('âœ… ChatModule Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
                if (typeof window.ChatModule.fetchChats === 'function') {
                    log('ğŸ”„ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ fetchChats...');
                    await window.ChatModule.fetchChats();
                    log('âœ… fetchChats Ø§Ø¬Ø±Ø§ Ø´Ø¯');
                } else {
                    log('âŒ fetchChats Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª', 'error');
                }
            } else {
                log('âŒ ChatModule Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª', 'error');
            }
        }
        
        // Ø±ØµØ¯ modules
        const checkInterval = setInterval(() => {
            checkModules();
            if (window.AuthModule && window.ChatModule && window.UIModule && window.TTSModule) {
                log('ğŸ‰ Ù‡Ù…Ù‡ modules Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù†Ø¯!');
                clearInterval(checkInterval);
            }
        }, 500);
        
        log('ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øª Ø³ÛŒØ³ØªÙ…...');
        
        // Override console
        const originalLog = console.log;
        console.log = (...args) => {
            originalLog(...args);
            log(args.join(' '));
        };
        
        const originalError = console.error;
        console.error = (...args) => {
            originalError(...args);
            log(args.join(' '), 'error');
        };
        
        setTimeout(() => {
            log('â° 3 Ø«Ø§Ù†ÛŒÙ‡ Ú¯Ø°Ø´Øª - Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª...');
            checkModules();
            testAuth();
        }, 3000);
    </script>
    
    <!-- Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ modules -->
    <script src="js/modules/auth.js" defer></script>
    <script src="js/modules/ui.js" defer></script>
    <script src="js/modules/chat.js" defer></script>
    <script src="js/modules/tts.js" defer></script>
    <script src="js/app.js" defer></script>
</body>
</html>
