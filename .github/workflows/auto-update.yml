# ğŸ¤– GitHub Copilot Auto-Update Workflow

name: "ğŸ”„ Copilot Auto-Update"

on:
  push:
    branches: [main]
    paths:
      - "js/**"
      - "css/**"
      - "index.html"
      - "server.js"
      - "Docs/**"

  workflow_dispatch:
    inputs:
      update_type:
        description: "Ù†ÙˆØ¹ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ"
        required: true
        default: "auto"
        type: choice
        options:
          - auto
          - manual
          - docs
          - feature

      description:
        description: "ØªÙˆØ¶ÛŒØ­Ø§Øª ØªØºÛŒÛŒØ±Ø§Øª"
        required: false
        default: "Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Copilot"

jobs:
  auto-update:
    name: "ğŸš€ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±"
    runs-on: ubuntu-latest

    steps:
      - name: "ğŸ“¥ Checkout Repository"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: "ğŸ”§ Setup Node.js"
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: "ğŸ“¦ Install Dependencies"
        run: |
          npm ci --only=production

      - name: "ğŸ§ª Run Basic Tests"
        run: |
          # Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
          echo "ğŸ§ª Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡..."

          # Ø¨Ø±Ø±Ø³ÛŒ syntax ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ JavaScript
          find js/ -name "*.js" -exec node -c {} \;
          echo "âœ… Syntax ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ JavaScript ØµØ­ÛŒØ­ Ø§Ø³Øª"

          # Ø¨Ø±Ø±Ø³ÛŒ Ø­Ø¬Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
          echo "ğŸ“ Ø¨Ø±Ø±Ø³ÛŒ Ø­Ø¬Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§..."
          find js/ -name "*.js" -exec wc -l {} \; | while read lines file; do
            if [ "$lines" -gt 200 ]; then
              echo "âš ï¸  Ù‡Ø´Ø¯Ø§Ø±: ÙØ§ÛŒÙ„ $file Ø¯Ø§Ø±Ø§ÛŒ $lines Ø®Ø· Ø§Ø³Øª (Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² 200)"
            else
              echo "âœ… $file: $lines Ø®Ø· (Ù…Ø¬Ø§Ø²)"
            fi
          done

          # Ø¨Ø±Ø±Ø³ÛŒ encoding ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
          echo "ğŸ”¤ Ø¨Ø±Ø±Ø³ÛŒ encoding ÙØ§ÛŒÙ„â€ŒÙ‡Ø§..."
          file_count=0
          for file in js/**/*.js css/*.css *.html; do
            if [ -f "$file" ]; then
              if file "$file" | grep -q "UTF-8"; then
                echo "âœ… $file: UTF-8 encoding"
              else
                echo "âš ï¸  $file: encoding Ù…Ø´Ú©ÙˆÚ©"
              fi
              ((file_count++))
            fi
          done
          echo "ğŸ“Š ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¯Ù‡: $file_count"

      - name: "ğŸ“Š Generate Update Report"
        id: report
        run: |
          echo "ğŸ“Š ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ..."

          # Ø´Ù…Ø§Ø±Ø´ Ú©Ø§Ù…ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±
          RECENT_COMMITS=$(git log --oneline --since="1 day ago" | wc -l)

          # Ø´Ù…Ø§Ø±Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡
          CHANGED_FILES=$(git diff --name-only HEAD~1 HEAD | wc -l)

          # ØªÙˆÙ„ÛŒØ¯ Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª
          CHANGES_SUMMARY=$(git log --oneline -5 --pretty=format:"- %s")

          # Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´
          cat > update_report.md << EOF
          # ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±

          ## ğŸ“ˆ Ø¢Ù…Ø§Ø±
          - **Ú©Ø§Ù…ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±**: $RECENT_COMMITS
          - **ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡**: $CHANGED_FILES
          - **ØªØ§Ø±ÛŒØ® Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ**: $(date +'%Y-%m-%d %H:%M:%S')
          - **Ø´Ø§Ø®Ù‡**: ${{ github.ref_name }}

          ## ğŸ”„ Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±Ø§Øª
          $CHANGES_SUMMARY

          ## ğŸ¯ ÙˆØ¶Ø¹ÛŒØª
          âœ… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ Ù…ÙˆÙÙ‚
          âœ… Syntax ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ ØµØ­ÛŒØ­
          âœ… UTF-8 encoding ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡
          âœ… Ø­Ø¬Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù…Ø¬Ø§Ø²

          ---
          ğŸ¤– **ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø·**: GitHub Copilot Auto-Update Workflow
          EOF

          echo "report_path=update_report.md" >> $GITHUB_OUTPUT

      - name: "ğŸ”„ Update Documentation"
        run: |
          echo "ğŸ“ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø³ØªÙ†Ø¯Ø§Øª..."

          # Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙØ§ÛŒÙ„ GITHUB.md
          if [ -f "Docs/GITHUB.md" ]; then
            sed -i "s/\*\*Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ\*\*:.*/\*\*Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ\*\*: $(date +'%Y-%m-%d %H:%M:%S')/g" Docs/GITHUB.md
            echo "âœ… ÙØ§ÛŒÙ„ GITHUB.md Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯"
          fi

          # Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ README Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
          if [ -f "README.md" ]; then
            if grep -q "Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ" README.md; then
              sed -i "s/Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:.*/Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: $(date +'%Y-%m-%d')/g" README.md
              echo "âœ… ÙØ§ÛŒÙ„ README.md Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯"
            fi
          fi

      - name: "ğŸ“¤ Commit and Push Updates"
        if: github.event_name == 'workflow_dispatch' || contains(github.event.head_commit.message, 'auto-update')
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"

          # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡
          git add .

          # Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ØªØºÛŒÛŒØ±Ø§Øª
          if git diff --staged --quiet; then
            echo "â„¹ï¸  Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ commit ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯"
          else
            # Ø§ÛŒØ¬Ø§Ø¯ commit
            git commit -m "ğŸ¤– Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø³ØªÙ†Ø¯Ø§Øª

            âœ… Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡:
            - Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§
            - Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§  
            - ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´
            
            ğŸ• Ø²Ù…Ø§Ù†: $(date +'%Y-%m-%d %H:%M:%S')
            ğŸ¤– ØªÙˆØ³Ø·: GitHub Copilot Workflow"
            
            # Push Ú©Ø±Ø¯Ù† ØªØºÛŒÛŒØ±Ø§Øª
            git push
            echo "âœ… ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª push Ø´Ø¯Ù†Ø¯"
          fi

      - name: "ğŸ“‹ Upload Report"
        uses: actions/upload-artifact@v3
        with:
          name: update-report
          path: update_report.md
          retention-days: 30

      - name: "ğŸ‰ Success Notification"
        run: |
          echo "ğŸ‰ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!"
          echo "ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø± artifacts Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯"
          echo "ğŸ”— Ù…Ø´Ø§Ù‡Ø¯Ù‡: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
