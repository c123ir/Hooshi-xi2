<!-- File: index.html -->
<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ุฏุณุชุงุฑ ููุด ูุตููุน</title>
    <!-- ุจุงุฑฺฏุฑ ูููุช ูุงุฑุณ ุงุฒ Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- ุขฺฉููโูุง FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- ูุงูโูุง ุงุณุชุงู -->
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <!-- overlay ุจุฑุง ุจุณุชู ุณุงุฏุจุงุฑ ุฏุฑ ููุจุงู -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>
    
    <div id="app">
      <!-- ุณุงุฏุจุงุฑ ุฌูุช ููุงุด ูุณุช ฺุชโูุง -->
      <aside id="sidebar" class="sidebar">
        <div id="userInfo" class="user-info" style="display: none;">
          <i class="fa fa-user"></i>
          <span id="currentUsername">ฺฉุงุฑุจุฑ</span>
        </div>
        <div class="sidebar-header">
          <div class="sidebar-title">ฺฏูุชฺฏููุง</div>
          <div class="sidebar-buttons">
            <button id="newChatBtn" class="icon-btn" title="ฺฏูุชฺฏู ุฌุฏุฏ">
              <i class="fa fa-plus"></i>
            </button>
            <button id="copyAllBtn" class="icon-btn" title="ฺฉูพ ฺฉู ฺฏูุชฺฏู">
              <i class="fa fa-copy"></i>
            </button>
            <label id="importLabel" class="icon-btn" title="ุงููพูุฑุช ฺุช">
              <i class="fa fa-file-import"></i>
              <input type="file" id="importInput" accept="application/json" style="display:none;" />
            </label>
            <button id="settingsBtn" class="icon-btn" title="ุชูุธูุงุช ูุฏู">
              <i class="fa fa-gear"></i>
            </button>
            <button id="logoutBtn" class="icon-btn" title="ุฎุฑูุฌ">
              <i class="fa fa-right-from-bracket"></i>
            </button>
          </div>
        </div>
        <div class="sidebar-search">
          <input
            type="text"
            id="searchInput"
            placeholder="ุฌุณุชุฌู..."
            autocomplete="off"
          />
        </div>
        <ul id="chatList" class="chat-list"></ul>
      </aside>
      <!-- ุจุฎุด ุงุตู -->
      <div id="mainContent" class="main-content">
        <header class="chat-header">
          <button id="menuToggle" class="icon-btn mobile-only" aria-label="ุจุงุฒ ฺฉุฑุฏู ููู">
            <i class="fa fa-bars"></i>
          </button>
          <h1 id="currentSubject">ฺฏูุชฺฏู ุฌุฏุฏ</h1>
          <div class="header-actions">
            <button id="ttsSettingsBtn" class="icon-btn" title="ุชูุธูุงุช ุตูุช">
              <i class="fa fa-cog"></i>
            </button>
            <button id="speakAllBtn" class="icon-btn" title="ูพุฎุด ุตูุช ฺฉู ฺฏูุชฺฏู">
              <i class="fa fa-volume-up"></i>
            </button>
          </div>
        </header>
        <main class="chat-main">
          <div id="chat-container" class="chat-container" aria-live="polite"></div>
          <form id="chat-form" class="chat-form">
            <textarea
              id="userInput"
              placeholder="ูพุงู ุฎูุฏ ุฑุง ุจููุณุฏ..."
              rows="1"
              required
              autocomplete="off"
            ></textarea>
            <button type="submit" id="sendBtn" class="icon-btn" title="ุงุฑุณุงู">
              <i class="fa fa-paper-plane"></i>
            </button>
          </form>
        </main>
      </div>
    </div>
    <!-- ููุฏุงู ุชูุธูุงุช ูุฏู -->
    <div id="settingsModal" class="modal">
      <div class="modal-content">
        <h3>ุชูุธูุงุช ูุฏู OpenAI</h3>
        <div class="model-options">
          <div class="model-option">
            <input type="radio" name="model" value="gpt-4o" id="model-gpt4o">
            <label for="model-gpt4o">
              <strong>GPT-4o</strong>
              <span style="color: #28a745; font-weight: 500;">(ุณุฑุน ู ุจุงฺฉูุช)</span>
            </label>
          </div>
          <div class="model-option">
            <input type="radio" name="model" value="gpt-4o-mini" id="model-gpt4omini">
            <label for="model-gpt4omini">
              <strong>GPT-4o Mini</strong>
              <span style="color: #007bff; font-weight: 500;">(ุงุฑุฒุงู ู ุณุฑุน)</span>
            </label>
          </div>
          <div class="model-option">
            <input type="radio" name="model" value="gpt-3.5-turbo" id="model-gpt35">
            <label for="model-gpt35">
              <strong>GPT-3.5 Turbo</strong>
              <span style="color: #6c757d; font-weight: 500;">(ุงูุชุตุงุฏ)</span>
            </label>
          </div>
        </div>
        <div class="model-description">
          <strong>ููุงุณู ูุฏูโูุง:</strong><br>
          <span style="color: #28a745;">GPT-4o</span>: ุณุฑุนุช ู ฺฉูุช ุจุงูุงุ ููุงุณุจ ูพุงุณุฎโูุง ูพฺุฏู ู ุชุญูู.<br>
          <span style="color: #007bff;">GPT-4o Mini</span>: ุงุฑุฒุงูโุชุฑุ ููุงุณุจ ฺุชโูุง ฺฉูุชุงู ู ุณุฑุน.<br>
          <span style="color: #6c757d;">GPT-3.5 Turbo</span>: ุงูุชุตุงุฏุ ููุงุณุจ ูฺฉุงููุงุช ุนููู.
        </div>
        <div class="modal-buttons">
          <button id="openPasswordBtn" class="btn-secondary">ุชุบุฑ ฺฏุฐุฑูุงฺู</button>
          <button id="adminPanelBtn" class="btn-admin" style="display: none;">
            <i class="fa fa-cogs"></i>
            ูุฏุฑุช ุณุฑูุฑ
          </button>
          <button id="saveModelBtn" class="btn-primary">ุฐุฎุฑู ุชูุธูุงุช</button>
          <button id="closeSettingsBtn" class="btn-secondary">ุจุณุชู</button>
        </div>
      </div>
    </div>
    <!-- ููุฏุงู ูุฑูุฏ -->
    <div id="loginModal" class="modal">
      <div class="modal-content">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <i class="fa fa-user-circle" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
          <h3>ูุฑูุฏ ุจู ุญุณุงุจ ฺฉุงุฑุจุฑ</h3>
          <p style="color: #6c757d; margin: 0;">ุจุฑุง ุงุฏุงููุ ูุงุฑุฏ ุญุณุงุจ ุฎูุฏ ุดูุฏ</p>
        </div>
        <label for="loginUsername">ูุงู ฺฉุงุฑุจุฑ</label>
        <input id="loginUsername" type="text" placeholder="ูุงู ฺฉุงุฑุจุฑ ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ" autocomplete="username" />
        <label for="loginPassword">ฺฏุฐุฑูุงฺู</label>
        <input id="loginPassword" type="password" placeholder="ฺฏุฐุฑูุงฺู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ" autocomplete="current-password" />
        <div class="modal-buttons">
          <button id="loginSubmit" class="btn-primary">ูุฑูุฏ</button>
        </div>
        <div style="text-align: center; margin-top: 1rem; font-size: 0.9rem; color: #6c757d;">
          ุงฺฏุฑ ุญุณุงุจ ฺฉุงุฑุจุฑ ูุฏุงุฑุฏุ ุจุง ูุฑูุฏ ุงุทูุงุนุงุชุ ุญุณุงุจ ุฌุฏุฏ ุงุฌุงุฏ ูโุดูุฏ
        </div>
      </div>
    </div>
    <!-- ููุฏุงู ุชุบุฑ ฺฏุฐุฑูุงฺู -->
    <div id="passwordModal" class="modal">
      <div class="modal-content">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <i class="fa fa-key" style="font-size: 2.5rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
          <h3>ุชุบุฑ ฺฏุฐุฑูุงฺู</h3>
          <p style="color: #6c757d; margin: 0;">ุจุฑุง ุงููุช ุญุณุงุจุ ฺฏุฐุฑูุงฺู ูู ุงูุชุฎุงุจ ฺฉูุฏ</p>
        </div>
        <label for="currentPassword">ฺฏุฐุฑูุงฺู ูุนู</label>
        <input id="currentPassword" type="password" placeholder="ฺฏุฐุฑูุงฺู ูุนู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ" autocomplete="current-password" />
        <label for="newPassword">ฺฏุฐุฑูุงฺู ุฌุฏุฏ</label>
        <input id="newPassword" type="password" placeholder="ฺฏุฐุฑูุงฺู ุฌุฏุฏ ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ" autocomplete="new-password" />
        <div class="modal-buttons">
          <button id="passwordSubmit" class="btn-primary">ุฐุฎุฑู ุชุบุฑุงุช</button>
          <button id="passwordCancel" class="btn-secondary">ุงูุตุฑุงู</button>
        </div>
      </div>
    </div>
    
    <!-- ููุฏุงู ุชูุธูุงุช TTS -->
    <div id="ttsSettingsModal" class="modal">
      <div class="modal-content">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <i class="fa fa-volume-up" style="font-size: 2.5rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
          <h3>ุชูุธูุงุช ุตูุช</h3>
          <p style="color: #6c757d; margin: 0;">ุชูุธูุงุช ูพุฎุด ุตูุช ูุชูโูุง</p>
        </div>
        <div class="tts-grid">
          <div class="tts-left">
            <div class="tts-setting">
              <label for="ttsVoice">ุงูุชุฎุงุจ ุตุฏุง</label>
              <select id="ttsVoice">
                <option value="alloy">Alloy (ุฎูุซ)</option>
                <option value="echo">Echo (ูุฑุฏุงูู)</option>
                <option value="fable">Fable (ุงูฺฏูุณ ุจุฑุชุงูุง)</option>
                <option value="onyx">Onyx (ูุฑุฏุงูู ุนูู)</option>
                <option value="nova">Nova (ุฒูุงูู)</option>
                <option value="shimmer">Shimmer (ุฒูุงูู ูุฑู)</option>
              </select>
            </div>

            <div class="tts-setting">
              <label>ุฌูุณุช ุตุฏุง</label>
              <div class="gender-toggle">
                <label><input type="radio" name="ttsGender" value="neutral"> <i class="fa fa-user-astronaut"></i> ุฎูุซ</label>
                <label><input type="radio" name="ttsGender" value="male"> <i class="fa fa-mars"></i> ูุฑุฏ</label>
                <label><input type="radio" name="ttsGender" value="female"> <i class="fa fa-venus"></i> ุฒู</label>
              </div>
            </div>

            <div class="tts-setting">
              <label for="ttsQuality">ฺฉูุช ุตุฏุง</label>
              <select id="ttsQuality">
                <option value="standard">ูุนููู (ฺฉูโูุฒูู)</option>
                <option value="high">ุจุงูุง (ฺฉูุช ุจูุชุฑ - ูุฒูู ุจุดุชุฑ)</option>
              </select>
            </div>

            <div class="tts-setting">
              <label for="ttsSpeed">ุณุฑุนุช ูพุฎุด</label>
              <input type="range" id="ttsSpeed" min="0.25" max="2.0" step="0.05" value="1.0">
              <span id="ttsSpeedValue">1.0x</span>
            </div>
          </div>

          <div class="tts-right">
            <div class="tts-setting">
              <label for="ttsCostTier">ุฑุฏู ูุฒูู</label>
              <select id="ttsCostTier">
                <option value="low">ฺฉู (ุงูุชุตุงุฏ)</option>
                <option value="medium">ูุชูุณุท</option>
                <option value="high">ุจุงูุง (ุจุง ฺฉูุช ุจุดุชุฑ)</option>
              </select>
            </div>

            <div class="tts-setting">
              <label for="ttsSample">ูุชู ููููู</label>
              <textarea id="ttsSample" rows="4" placeholder="ูุชู ููููู ุจุฑุง ุชุณุช ุตุฏุง...">ุณูุงู! ุงู ฺฉ ููููู ุชุณุช ุตูุช ุงุณุช.</textarea>
            </div>

            <div class="cost-info">
              <div>ุชุฎูู ูุฒูู (ุจู ุงุฒุง 1000 ฺฉุงุฑุงฺฉุชุฑ): <strong id="costEstimate">โ</strong></div>
              <small style="color:#6c757d">ฺฉูุช ุจุงูุงุชุฑ ูุฒูู ุฑุง ุงูุฒุงุด ูโุฏูุฏ.</small>
            </div>
          </div>
        </div>

        <div class="tts-test">
          <button id="ttsTestBtn" class="btn-secondary">
            <i class="fa fa-play"></i> ูพุฎุด ููููู
          </button>
        </div>

        <div class="modal-buttons">
          <button id="ttsSettingsSave" class="btn-primary">ุฐุฎุฑู ุชูุธูุงุช</button>
          <button id="ttsSettingsClose" class="btn-secondary">ุจุณุชู</button>
        </div>
      </div>
    </div>
    
    <!-- ูุงูโูุง ุงุณฺฉุฑูพุช -->
    <script src="js/modules/auth.js" defer></script>
    <script src="js/modules/ui.js" defer></script>
    <script src="js/modules/chat.js" defer></script>
    <script src="js/modules/tts.js" defer></script>
    <script src="js/app.js" defer></script>
    
    <!-- ุชุณุช ุณุฑุน -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('๐ DOM ุขูุงุฏู - ุชุณุช ุงููู');
            setTimeout(() => {
                console.log('โฐ ุชุณุช ุจุนุฏ ุงุฒ 1 ุซุงูู...');
                
                // ุชุณุช manual chat loading
                const chatList = document.getElementById('chatList');
                if (chatList && !chatList.innerHTML.trim()) {
                    console.log('๐ฌ ูุณุช ฺุช ุฎุงู ุงุณุช - ุชูุงุด ุจุฑุง ุจุงุฑฺฏุฑ...');
                    
                    // ูุฑุงุฎูุงู manual API
                    fetch('/api/chats')
                        .then(res => res.json())
                        .then(chats => {
                            console.log('๐ฅ ฺุชโูุง ุฏุฑุงูุช:', chats.length);
                            if (chats.length > 0) {
                                chatList.innerHTML = chats.map(chat => 
                                    `<div class="chat-item" data-id="${chat.id}">
                                        <div class="chat-subject">${chat.subject}</div>
                                        <div class="chat-date">${new Date(chat.createdAt).toLocaleDateString('fa-IR')}</div>
                                    </div>`
                                ).join('');
                                console.log('โ ูุณุช ฺุช ุฑูุฏุฑ ุดุฏ!');
                            }
                        })
                        .catch(err => console.error('โ ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฑ ฺุชโูุง:', err));
                }
            }, 1000);
        });
    </script>
    <!-- ุดูุงูุฑ ฺฉูุชุฑู ูพุฎุด ุตูุช -->
    <div id="floatingTTSControl" class="floating-tts-control" title="ุชููู/ุงุฏุงูู ูพุฎุด">
      <i id="floatingTTSIcon" class="fa fa-volume-up"></i>
    </div>
  </body>
</html>